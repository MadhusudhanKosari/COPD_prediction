<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connect with Doctor</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Add Back Button -->
    <div class="back-navigation">
        <a href="../index.html">
            <button id="backButton" class="back-home-btn">
                <i class="fas fa-arrow-left"></i>
                <span>Back to Dashboard</span>
            </button>
        </a>
    </div>

    <div class="appointment-container">
        <header class="appointment-header">
            <h1>Connect with a Doctor</h1>
            <p>Book an appointment with our certified healthcare professionals</p>
        </header>

        <div class="doctor-selection">
            <h2>Select a Doctor</h2>
            <div class="doctor-cards">
                <div class="doctor-card" data-id="1">
                    <img src="https://img.freepik.com/free-photo/doctor-with-his-arms-crossed-white-background_1368-5790.jpg" alt="Dr. Sarah Johnson">
                    <h3>Dr. Sarah Johnson</h3>
                    <p>Cardiologist</p>
                    <div class="rating">
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star-half-alt"></i>
                        <span>4.7 (128 reviews)</span>
                    </div>
                    <button class="select-btn">Select</button>
                </div>

                <div class="doctor-card" data-id="2">
                    <img src="https://img.freepik.com/free-photo/young-bearded-man-with-stethoscope_273609-20597.jpg" alt="Dr. Michael Chen">
                    <h3>Dr. Michael Chen</h3>
                    <p>Neurologist</p>
                    <div class="rating">
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="far fa-star"></i>
                        <span>4.2 (95 reviews)</span>
                    </div>
                    <button class="select-btn">Select</button>
                </div>

                <div class="doctor-card" data-id="3">
                    <img src="https://img.freepik.com/free-photo/indian-doctor-standing-with-his-arms-crossed_1368-5794.jpg" alt="Dr. Priya Patel">
                    <h3>Dr. Prathik Patel</h3>
                    <p>Pulmonologist</p>
                    <div class="rating">
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <span>5.0 (210 reviews)</span>
                    </div>
                    <button class="select-btn">Select</button>
                </div>
            </div>
        </div>

        <div class="appointment-form-container" style="display: none;">
            <h2>Book Your Appointment</h2>
            <form id="appointmentForm" class="appointment-form">
                <div class="form-group">
                    <label for="fullName">Full Name</label>
                    <input type="text" id="fullName" name="fullName" required>
                </div>
                
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" name="email" required>
                </div>
                
                <div class="form-group">
                    <label for="phone">Phone Number</label>
                    <input type="tel" id="phone" name="phone" required>
                </div>
                
                <div class="form-group">
                    <label for="dob">Date of Birth</label>
                    <input type="date" id="dob" name="dob" required>
                </div>
                
                <div class="form-group">
                    <label for="appointmentDate">Preferred Date</label>
                    <input type="date" id="appointmentDate" name="appointmentDate" required>
                </div>
                
                <div class="form-group">
                    <label for="appointmentTime">Preferred Time</label>
                    <select id="appointmentTime" name="appointmentTime" required>
                        <option value="">Select a time</option>
                        <option value="09:00-10:00">09:00 AM - 10:00 AM</option>
                        <option value="10:00-11:00">10:00 AM - 11:00 AM</option>
                        <option value="11:00-12:00">11:00 AM - 12:00 PM</option>
                        <option value="13:00-14:00">01:00 PM - 02:00 PM</option>
                        <option value="14:00-15:00">02:00 PM - 03:00 PM</option>
                        <option value="15:00-16:00">03:00 PM - 04:00 PM</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="symptoms">Symptoms/Reason for Visit</label>
                    <textarea id="symptoms" name="symptoms" rows="4" required></textarea>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="back-btn">Back to Doctors</button>
                    <button type="submit" class="submit-btn">Book Appointment</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="modal-overlay" id="confirmationModal" style="display: none;">
        <div class="modal-content">
            <span class="close-modal">Ã—</span>
            <div class="modal-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <h2>Appointment Booked Successfully!</h2>
            <p>Your appointment with <span id="confirmedDoctor">Dr. Sarah Johnson</span> has been scheduled.</p>
            <p>Date: <span id="confirmedDate">June 15, 2023</span></p>
            <p>Time: <span id="confirmedTime">10:00 AM - 11:00 AM</span></p>
            <p>A confirmation has been sent to your email.</p>
            <button class="modal-close-btn">Close</button>
        </div>
    </div>
    <meta charset="utf-8">
    <title>BreatheWise Chatbot</title>
    <link rel="stylesheet" href="styles.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@48,400,1,0" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap');
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Poppins", sans-serif;
        }
        body {
            background: #E3F2FD;
        }
        .chatbot-toggler {
            position: fixed;
            bottom: 30px;
            right: 35px;
            outline: none;
            border: none;
            height: 50px;
            width: 50px;
            display: flex;
            cursor: pointer;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: #4CAF50;
            transition: all 0.2s ease;
        }
        body.show-chatbot .chatbot-toggler {
            transform: rotate(90deg);
        }
        .chatbot-toggler span {
            color: #fff;
            position: absolute;
        }
        .chatbot-toggler span:last-child,
        body.show-chatbot .chatbot-toggler span:first-child  {
            opacity: 0;
        }
        body.show-chatbot .chatbot-toggler span:last-child {
            opacity: 1;
        }
        .chatbot {
            position: fixed;
            right: 35px;
            bottom: 90px;
            width: 420px;
            background: #fff;
            border-radius: 15px;
            overflow: hidden;
            opacity: 0;
            pointer-events: none;
            transform: scale(0.5);
            transform-origin: bottom right;
            box-shadow: 0 0 128px 0 rgba(0,0,0,0.1),
                        0 32px 64px -48px rgba(0,0,0,0.5);
            transition: all 0.1s ease;
        }
        body.show-chatbot .chatbot {
            opacity: 1;
            pointer-events: auto;
            transform: scale(1);
        }
        .chatbot header {
            padding: 16px 0;
            position: relative;
            text-align: center;
            color: #fff;
            background: #4CAF50;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .chatbot header span {
            position: absolute;
            right: 15px;
            top: 50%;
            display: none;
            cursor: pointer;
            transform: translateY(-50%);
        }
        header h2 {
            font-size: 1.4rem;
        }
        .chatbot .chatbox {
            overflow-y: auto;
            height: 510px;
            padding: 30px 20px 100px;
        }
        .chatbot :where(.chatbox, textarea)::-webkit-scrollbar {
            width: 6px;
        }
        .chatbot :where(.chatbox, textarea)::-webkit-scrollbar-track {
            background: #fff;
            border-radius: 25px;
        }
        .chatbot :where(.chatbox, textarea)::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 25px;
        }
        .chatbox .chat {
            display: flex;
            list-style: none;
        }
        .chatbox .outgoing {
            margin: 20px 0;
            justify-content: flex-end;
        }
        .chatbox .incoming span {
            width: 32px;
            height: 32px;
            color: #fff;
            cursor: default;
            text-align: center;
            line-height: 32px;
            align-self: flex-end;
            background: #4CAF50;
            border-radius: 50%;
            margin: 0 10px 7px 0;
        }
        .chatbox .chat p {
            white-space: pre-wrap;
            padding: 12px 16px;
            border-radius: 10px 10px 0 10px;
            max-width: 75%;
            color: #fff;
            font-size: 0.95rem;
            background: #4CAF50;
        }
        .chatbox .incoming p {
            border-radius: 10px 10px 10px 0;
        }
        .chatbox .chat p.error {
            color: #721c24;
            background: #f8d7da;
        }
        .chatbox .incoming p {
            color: #000;
            background: #f2f2f2;
        }
        .chatbot .chat-input {
            display: flex;
            gap: 5px;
            position: absolute;
            bottom: 0;
            width: 100%;
            background: #fff;
            padding: 3px 20px;
            border-top: 1px solid #ddd;
        }
        .chat-input textarea {
            height: 55px;
            width: 100%;
            border: none;
            outline: none;
            resize: none;
            max-height: 180px;
            padding: 15px 15px 15px 0;
            font-size: 0.95rem;
        }
        .chat-input span {
            align-self: flex-end;
            color: #4CAF50;
            cursor: pointer;
            height: 55px;
            display: flex;
            align-items: center;
            visibility: hidden;
            font-size: 1.35rem;
        }
        .chat-input textarea:valid ~ span {
            visibility: visible;
        }
        @media (max-width: 490px) {
            .chatbot-toggler {
                right: 20px;
                bottom: 20px;
            }
            .chatbot {
                right: 0;
                bottom: 0;
                height: 100%;
                border-radius: 0;
                width: 100%;
            }
            .chatbot .chatbox {
                height: 90%;
                padding: 25px 15px 100px;
            }
            .chatbot .chat-input {
                padding: 5px 15px;
            }
            .chatbot header span {
                display: block;
            }
        }
    </style>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const chatbotToggler = document.querySelector(".chatbot-toggler");
            const closeBtn = document.querySelector(".close-btn");
            const chatbox = document.querySelector(".chatbox");
            const chatInput = document.querySelector(".chat-input textarea");
            const sendChatBtn = document.querySelector(".chat-input span");

            let userMessage = null;
            const inputInitHeight = chatInput.scrollHeight;

            const API_KEY = "AIzaSyB1OaBlUxardbcVAp7jQyh8kRvJ-gfjriI";
            const API_URL =`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${API_KEY}`;

            const createChatLi = (message, className) => {
                const chatLi = document.createElement("li");
                chatLi.classList.add("chat", className);
                let chatContent = className === "outgoing" ? `<p></p>` : `<span class="material-symbols-outlined">message</span><p></p>`;
                chatLi.innerHTML = chatContent;
                chatLi.querySelector("p").textContent = message;
                return chatLi;
            }

            const generateResponse = async (chatElement) => {
                const messageElement = chatElement.querySelector("p");
                
                // Check if the message contains COPD-related keywords
                const copdKeywords = ['copd', 'chronic obstructive pulmonary disease', 'emphysema', 'bronchitis', 'lung', 'breathing', 'respiratory', 'inhaler', 'breathe', 'oxygen', 'pulmonary'];
                const containsCopdKeywords = copdKeywords.some(keyword => userMessage.toLowerCase().includes(keyword));
                
                if (!containsCopdKeywords) {
                    messageElement.textContent = "I apologize, but I can only assist with COPD-related questions. Please ask something about COPD, its symptoms, treatment, or management.";
                    return;
                }

                const requestOptions = {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ 
                        contents: [{ 
                            role: "user", 
                            parts: [{ text: userMessage }] 
                        }] 
                    }),
                }

                try {
                    const response = await fetch(API_URL, requestOptions);
                    const data = await response.json();
                    if (!response.ok) throw new Error(data.error.message);
                
                    messageElement.textContent = data.candidates[0].content.parts[0].text.replace(/\\(.?)\\*/g, '$1');
                } catch (error) {
                    messageElement.classList.add("error");
                    messageElement.textContent = error.message;
                } finally {
                    chatbox.scrollTo(0, chatbox.scrollHeight);
                }
            }

            const handleChat = () => {
                userMessage = chatInput.value.trim();
                if (!userMessage) return;

                chatInput.value = "";
                chatInput.style.height = `${inputInitHeight}px`;

                chatbox.appendChild(createChatLi(userMessage, "outgoing"));
                chatbox.scrollTo(0, chatbox.scrollHeight);

                setTimeout(() => {
                    const incomingChatLi = createChatLi("Thinking...", "incoming");
                    chatbox.appendChild(incomingChatLi);
                    chatbox.scrollTo(0, chatbox.scrollHeight);
                    generateResponse(incomingChatLi);
                }, 600);
            }

            chatInput.addEventListener("input", () => {
                chatInput.style.height = `${inputInitHeight}px`;
                chatInput.style.height = `${chatInput.scrollHeight}px`;
            });

            chatInput.addEventListener("keydown", (e) => {
                if (e.key === "Enter" && !e.shiftKey && window.innerWidth > 800) {
                    e.preventDefault();
                    handleChat();
                }
            });

            sendChatBtn.addEventListener("click", handleChat);
            closeBtn.addEventListener("click", () => document.body.classList.remove("show-chatbot"));
            chatbotToggler.addEventListener("click", () => document.body.classList.toggle("show-chatbot"));
        });
    </script>
</head>
<body>
    <button class="chatbot-toggler">
        <span class="material-symbols-outlined">message</span>
        <span class="material-symbols-outlined">close</span>
    </button>
    <div class="chatbot">
        <header>
            <h2>BreatheWise Assistant</h2>
            <span class="close-btn material-symbols-outlined">close</span>
        </header>
        <ul class="chatbox">
            <li class="chat incoming">
                <span class="material-symbols-outlined">message</span>
                <p>Hello! I'm your BreatheWise assistant. I can help you with COPD-related questions only. What would you like to know about COPD?</p>
            </li>
        </ul>
        <div class="chat-input">
            <textarea placeholder="Enter a message..." spellcheck="false" required></textarea>
            <span id="send-btn" class="material-symbols-rounded">send</span>
        </div>
    </div>
    <script src="script.js"></script>
</body>
</html>